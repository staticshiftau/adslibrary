<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Facebook Ads Library - Professional Swipe File</title>

    <style>

        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

        }

 

        body {

            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;

            background: #f5f7fa;

            min-height: 100vh;

        }

 

        /* Global Search Bar */

        .global-search {

            background: white;

            padding: 20px 24px;

            border-bottom: 1px solid #e2e8f0;

            box-shadow: 0 1px 3px rgba(0,0,0,0.05);

        }

 

        .global-search-wrapper {

            max-width: 1600px;

            margin: 0 auto;

            display: flex;

            align-items: center;

            gap: 16px;

        }

 

        .search-icon {

            font-size: 20px;

            color: #64748b;

        }

 

        .global-search-input {

            flex: 1;

            padding: 14px 20px;

            border: 2px solid #e2e8f0;

            border-radius: 10px;

            font-size: 16px;

            transition: all 0.2s;

        }

 

        .global-search-input:focus {

            outline: none;

            border-color: #667eea;

            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);

        }

 

        /* Main Container */

        .main-container {

            display: flex;

            max-width: 1600px;

            margin: 0 auto;

            min-height: calc(100vh - 80px);

        }

 

        /* Filter Sidebar */

        .filter-sidebar {

            width: 320px;

            background: white;

            border-right: 1px solid #e2e8f0;

            padding: 24px;

            overflow-y: auto;

            position: sticky;

            top: 0;

            height: calc(100vh - 80px);

        }

 

        .sidebar-header {

            margin-bottom: 24px;

        }

 

        .sidebar-title {

            font-size: 18px;

            font-weight: 700;

            color: #1e293b;

            margin-bottom: 8px;

        }

 

        .sidebar-subtitle {

            font-size: 13px;

            color: #64748b;

        }

 

        .filter-section {

            margin-bottom: 24px;

        }

 

        .filter-label {

            font-size: 13px;

            font-weight: 700;

            color: #475569;

            text-transform: uppercase;

            letter-spacing: 0.5px;

            margin-bottom: 12px;

            display: block;

        }

 

        .filter-dropdown {

            width: 100%;

            padding: 10px 14px;

            border: 2px solid #e2e8f0;

            border-radius: 8px;

            font-size: 14px;

            color: #1e293b;

            background: white;

            cursor: pointer;

            transition: all 0.2s;

        }

 

        .filter-dropdown:hover {

            border-color: #cbd5e1;

        }

 

        .filter-dropdown:focus {

            outline: none;

            border-color: #667eea;

            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);

        }

 

        .rating-filter {

            display: flex;

            align-items: center;

            gap: 8px;

            padding: 10px 14px;

            border: 2px solid #e2e8f0;

            border-radius: 8px;

            cursor: pointer;

            transition: all 0.2s;

            user-select: none;

        }

 

        .rating-filter:hover {

            border-color: #cbd5e1;

        }

 

        .rating-filter.active {

            border-color: #667eea;

            background: #f0f4ff;

        }

 

        .rating-filter input[type="checkbox"] {

            width: 18px;

            height: 18px;

            cursor: pointer;

        }

 

        .rating-filter label {

            flex: 1;

            cursor: pointer;

            font-size: 14px;

            color: #1e293b;

            font-weight: 500;

        }

 

        .clear-filters-btn {

            width: 100%;

            padding: 12px;

            background: #ef4444;

            color: white;

            border: none;

            border-radius: 8px;

            font-size: 14px;

            font-weight: 700;

            cursor: pointer;

            transition: all 0.2s;

            margin-top: 24px;

        }

 

        .clear-filters-btn:hover {

            background: #dc2626;

            transform: translateY(-1px);

            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);

        }

 

        .clear-filters-btn:active {

            transform: translateY(0);

        }

 

        /* Tag Section in Sidebar */

        .tag-search-input {

            width: 100%;

            padding: 10px 14px;

            border: 2px solid #e2e8f0;

            border-radius: 8px;

            font-size: 14px;

            margin-bottom: 12px;

            transition: all 0.2s;

        }

 

        .tag-search-input:focus {

            outline: none;

            border-color: #667eea;

            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);

        }

 

        .sidebar-tags {

            display: flex;

            flex-wrap: wrap;

            gap: 8px;

            margin-top: 12px;

        }

 

        .sidebar-tag-pill {

            display: inline-flex;

            align-items: center;

            gap: 6px;

            padding: 6px 12px;

            background: #e0e7ff;

            color: #4338ca;

            border-radius: 16px;

            font-size: 12px;

            font-weight: 600;

            cursor: pointer;

            transition: all 0.2s;

        }

 

        .sidebar-tag-pill:hover {

            background: #c7d2fe;

        }

 

        .sidebar-tag-pill.selected {

            background: #4338ca;

            color: white;

        }

 

        /* Ad Results Area */

        .ad-results-area {

            flex: 1;

            padding: 24px;

            overflow-y: auto;

        }

 

        .results-header {

            margin-bottom: 24px;

        }

 

        .results-stats {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 16px;

            flex-wrap: wrap;

            gap: 16px;

        }

 

        .stats-left {

            display: flex;

            gap: 24px;

            align-items: center;

        }

 

        .stat-item {

            font-size: 14px;

            color: #64748b;

        }

 

        .stat-item strong {

            color: #1e293b;

            font-weight: 700;

        }

 

        .sort-dropdown {

            padding: 10px 16px;

            border: 2px solid #e2e8f0;

            border-radius: 8px;

            font-size: 14px;

            background: white;

            cursor: pointer;

            transition: all 0.2s;

        }

 

        .sort-dropdown:hover {

            border-color: #cbd5e1;

        }

 

        .sort-dropdown:focus {

            outline: none;

            border-color: #667eea;

        }

 

        /* Active Filter Pills */

        .active-filters {

            display: flex;

            flex-wrap: wrap;

            gap: 8px;

            margin-bottom: 20px;

        }

 

        .active-filter-pill {

            display: inline-flex;

            align-items: center;

            gap: 8px;

            padding: 8px 14px;

            background: #667eea;

            color: white;

            border-radius: 20px;

            font-size: 13px;

            font-weight: 600;

            animation: slideIn 0.2s ease-out;

        }

 

        .remove-filter {

            background: none;

            border: none;

            color: white;

            cursor: pointer;

            font-size: 18px;

            width: 20px;

            height: 20px;

            display: flex;

            align-items: center;

            justify-content: center;

            border-radius: 50%;

            transition: background 0.2s;

        }

 

        .remove-filter:hover {

            background: rgba(255,255,255,0.2);

        }

 

        @keyframes slideIn {

            from {

                opacity: 0;

                transform: translateY(-10px);

            }

            to {

                opacity: 1;

                transform: translateY(0);

            }

        }

 

        /* Ad Grid */

        .ads-grid {

            display: grid;

            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));

            gap: 24px;

        }

 

        .ad-card {

            background: white;

            border-radius: 12px;

            overflow: hidden;

            box-shadow: 0 2px 8px rgba(0,0,0,0.08);

            transition: all 0.3s;

            display: flex;

            flex-direction: column;

        }

 

        .ad-card:hover {

            transform: translateY(-4px);

            box-shadow: 0 8px 24px rgba(0,0,0,0.12);

        }

 

        .ad-image {

            width: 100%;

            aspect-ratio: 1.91/1;

            object-fit: cover;

            background: #f0f2f5;

        }

 

        .ad-content {

            padding: 20px;

            flex: 1;

            display: flex;

            flex-direction: column;

        }

 

        .ad-brand {

            font-size: 12px;

            font-weight: 700;

            color: #667eea;

            text-transform: uppercase;

            letter-spacing: 0.5px;

            margin-bottom: 4px;

        }

 

        .ad-brand a {

            color: #667eea;

            text-decoration: none;

            transition: color 0.2s;

        }

 

        .ad-brand a:hover {

            color: #764ba2;

            text-decoration: underline;

        }

 

        .ad-meta {

            display: flex;

            align-items: center;

            gap: 12px;

            margin-bottom: 12px;

            font-size: 11px;

            color: #94a3b8;

        }

 

        .ad-rating {

            display: flex;

            align-items: center;

            gap: 4px;

        }

 

        .star {

            color: #fbbf24;

            font-size: 14px;

        }

 

        .star.empty {

            color: #e2e8f0;

        }

 

        .ad-industry {

            display: inline-block;

            padding: 4px 12px;

            background: #f1f5f9;

            border-radius: 20px;

            font-size: 12px;

            color: #64748b;

            margin-bottom: 12px;

            font-weight: 500;

        }

 

        .ad-headline {

            font-size: 18px;

            font-weight: 700;

            color: #1e293b;

            margin-bottom: 12px;

            line-height: 1.4;

        }

 

        .ad-copy {

            font-size: 14px;

            color: #475569;

            line-height: 1.6;

            margin-bottom: 16px;

            flex: 1;

        }

 

        .ad-cta {

            display: inline-block;

            padding: 10px 24px;

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            color: white;

            text-decoration: none;

            border-radius: 8px;

            font-weight: 600;

            font-size: 14px;

            transition: transform 0.2s, box-shadow 0.2s;

            text-align: center;

        }

 

        .ad-cta:hover {

            transform: translateY(-2px);

            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);

        }

 

        .ad-tags-section {

            margin-top: 16px;

            padding-top: 16px;

            border-top: 1px solid #e2e8f0;

            display: flex;

            justify-content: space-between;

            align-items: center;

            gap: 12px;

        }

 

        .ad-tags-list {

            display: flex;

            flex-wrap: wrap;

            gap: 6px;

            flex: 1;

        }

 

        .tag-chip {

            display: inline-block;

            padding: 4px 10px;

            background: #e0e7ff;

            color: #4338ca;

            border-radius: 12px;

            font-size: 11px;

            font-weight: 600;

        }

 

        .add-tag-btn {

            padding: 6px 16px;

            background: #667eea;

            color: white;

            border: none;

            border-radius: 6px;

            font-size: 12px;

            font-weight: 600;

            cursor: pointer;

            transition: all 0.2s;

            white-space: nowrap;

            flex-shrink: 0;

        }

 

        .add-tag-btn:hover {

            background: #5568d3;

            transform: scale(1.05);

        }

 

        /* Modal */

        .modal {

            display: none;

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background: rgba(0,0,0,0.6);

            z-index: 1000;

            align-items: center;

            justify-content: center;

        }

 

        .modal.active {

            display: flex;

        }

 

        .modal-content {

            background: white;

            border-radius: 16px;

            padding: 32px;

            max-width: 500px;

            width: 90%;

            max-height: 80vh;

            overflow-y: auto;

        }

 

        .modal-header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 24px;

        }

 

        .modal-title {

            font-size: 24px;

            font-weight: 700;

            color: #1e293b;

        }

 

        .modal-close {

            background: none;

            border: none;

            font-size: 28px;

            color: #94a3b8;

            cursor: pointer;

            padding: 0;

            width: 32px;

            height: 32px;

            display: flex;

            align-items: center;

            justify-content: center;

            transition: color 0.2s;

        }

 

        .modal-close:hover {

            color: #1e293b;

        }

 

        .tag-input-wrapper {

            position: relative;

            margin-bottom: 24px;

        }

 

        .tag-input {

            width: 100%;

            padding: 12px 16px;

            border: 2px solid #e2e8f0;

            border-radius: 8px;

            font-size: 15px;

            transition: all 0.2s;

        }

 

        .tag-input:focus {

            outline: none;

            border-color: #667eea;

            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);

        }

 

        .tag-suggestions {

            position: absolute;

            top: 100%;

            left: 0;

            right: 0;

            background: white;

            border: 2px solid #e2e8f0;

            border-top: none;

            border-radius: 0 0 8px 8px;

            max-height: 200px;

            overflow-y: auto;

            z-index: 10;

            display: none;

        }

 

        .tag-suggestions.active {

            display: block;

        }

 

        .tag-suggestion-item {

            padding: 10px 16px;

            cursor: pointer;

            transition: background 0.2s;

            font-size: 14px;

        }

 

        .tag-suggestion-item:hover {

            background: #f1f5f9;

        }

 

        .current-tags {

            display: flex;

            flex-wrap: wrap;

            gap: 8px;

            margin-bottom: 24px;

            min-height: 40px;

        }

 

        .current-tag-chip {

            display: inline-flex;

            align-items: center;

            gap: 6px;

            padding: 6px 12px;

            background: #e0e7ff;

            color: #4338ca;

            border-radius: 16px;

            font-size: 13px;

            font-weight: 600;

        }

 

        .remove-tag {

            background: none;

            border: none;

            color: #4338ca;

            cursor: pointer;

            padding: 0;

            width: 16px;

            height: 16px;

            display: flex;

            align-items: center;

            justify-content: center;

            font-size: 16px;

            transition: color 0.2s;

        }

 

        .remove-tag:hover {

            color: #3730a3;

        }

 

        .save-tags-btn {

            width: 100%;

            padding: 14px;

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            color: white;

            border: none;

            border-radius: 8px;

            font-size: 16px;

            font-weight: 700;

            cursor: pointer;

            transition: transform 0.2s, box-shadow 0.2s;

        }

 

        .save-tags-btn:hover {

            transform: translateY(-2px);

            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);

        }

 

        .save-tags-btn:disabled {

            opacity: 0.5;

            cursor: not-allowed;

        }

 

        .loading {

            text-align: center;

            padding: 60px 20px;

            color: #64748b;

        }

 

        .spinner {

            border: 4px solid #e2e8f0;

            border-top: 4px solid #667eea;

            border-radius: 50%;

            width: 50px;

            height: 50px;

            animation: spin 1s linear infinite;

            margin: 0 auto 20px;

        }

 

        @keyframes spin {

            0% { transform: rotate(0deg); }

            100% { transform: rotate(360deg); }

        }

 

        /* Mobile Responsive */

        @media (max-width: 1024px) {

            .filter-sidebar {

                position: fixed;

                left: -320px;

                top: 0;

                height: 100vh;

                z-index: 999;

                transition: left 0.3s ease;

            }

 

            .filter-sidebar.open {

                left: 0;

                box-shadow: 2px 0 8px rgba(0,0,0,0.1);

            }

 

            .ads-grid {

                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));

            }

 

            .mobile-filter-toggle {

                position: fixed;

                bottom: 24px;

                right: 24px;

                width: 60px;

                height: 60px;

                background: #667eea;

                color: white;

                border: none;

                border-radius: 50%;

                font-size: 24px;

                cursor: pointer;

                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);

                z-index: 998;

                display: flex;

                align-items: center;

                justify-content: center;

            }

        }

 

        @media (min-width: 1025px) {

            .mobile-filter-toggle {

                display: none;

            }

        }

    </style>

</head>

<body>

    <!-- Global Search Bar -->

    <div class="global-search">

        <div class="global-search-wrapper">

            <span class="search-icon">üîç</span>

            <input

                type="text"

                id="globalSearch"

                class="global-search-input"

                placeholder="Search ads by headline, copy, or advertiser name..."

            >

        </div>

    </div>

 

    <!-- Main Container -->

    <div class="main-container">

        <!-- Filter Sidebar -->

        <aside class="filter-sidebar" id="filterSidebar">

            <div class="sidebar-header">

                <h2 class="sidebar-title">Filters</h2>

                <p class="sidebar-subtitle">Refine your ad search</p>

            </div>

 

            <!-- Industry Filter -->

            <div class="filter-section">

                <label class="filter-label">Industry</label>

                <select id="industryFilter" class="filter-dropdown">

                    <option value="">All Industries</option>

                </select>

            </div>

 

            <!-- Funnel Stage Filter -->

            <div class="filter-section">

                <label class="filter-label">Funnel Stage</label>

                <select id="funnelStageFilter" class="filter-dropdown">

                    <option value="">All Stages</option>

                </select>

            </div>

 

            <!-- Offer Type Filter -->

            <div class="filter-section">

                <label class="filter-label">Offer Type</label>

                <select id="offerTypeFilter" class="filter-dropdown">

                    <option value="">All Offer Types</option>

                </select>

            </div>

 

            <!-- Rating Filter -->

            <div class="filter-section">

                <label class="filter-label">Rating</label>

                <div class="rating-filter" id="ratingFilter">

                    <input type="checkbox" id="rating5plus">

                    <label for="rating5plus">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 Stars Only</label>

                </div>

            </div>

 

            <!-- Tags Section -->

            <div class="filter-section">

                <label class="filter-label">Client Tags</label>

                <input

                    type="text"

                    id="tagSearchInput"

                    class="tag-search-input"

                    placeholder="Search tags..."

                >

                <div class="sidebar-tags" id="sidebarTags"></div>

            </div>

 

            <!-- Clear Filters Button -->

            <button class="clear-filters-btn" onclick="clearAllFilters()">

                üóëÔ∏è Clear All Filters

            </button>

        </aside>

 

        <!-- Ad Results Area -->

        <main class="ad-results-area">

            <div class="results-header">

                <div class="results-stats">

                    <div class="stats-left">

                        <div class="stat-item">

                            Total Ads: <strong id="totalAds">0</strong>

                        </div>

                        <div class="stat-item">

                            Showing: <strong id="showingAds">0</strong> ads

                        </div>

                    </div>

                    <select id="sortBy" class="sort-dropdown">

                        <option value="newest">Sort by: Newest</option>

                        <option value="oldest">Sort by: Oldest</option>

                        <option value="rating-high">Sort by: Highest Rated</option>

                        <option value="rating-low">Sort by: Lowest Rated</option>

                    </select>

                </div>

 

                <!-- Active Filter Pills -->

                <div class="active-filters" id="activeFilters"></div>

            </div>

 

            <!-- Ads Grid -->

            <div class="ads-grid" id="adsGrid">

                <div class="loading">

                    <div class="spinner"></div>

                    Loading ads...

                </div>

            </div>

        </main>

    </div>

 

    <!-- Mobile Filter Toggle -->

    <button class="mobile-filter-toggle" onclick="toggleSidebar()">

        ‚öôÔ∏è

    </button>

 

    <!-- Tag Edit Modal -->

    <div class="modal" id="tagModal">

        <div class="modal-content">

            <div class="modal-header">

                <h2 class="modal-title">Edit Tags</h2>

                <button class="modal-close" onclick="closeTagModal()">√ó</button>

            </div>

 

            <div class="tag-input-wrapper">

                <input

                    type="text"

                    id="tagInput"

                    class="tag-input"

                    placeholder="Type to add or search tags..."

                    autocomplete="off"

                >

                <div class="tag-suggestions" id="tagSuggestions"></div>

            </div>

 

            <div class="current-tags" id="currentTags"></div>

 

            <button class="save-tags-btn" onclick="saveTagsToSheet()">

                Save Tags

            </button>

        </div>

    </div>

 

    <script>

        const CONFIG = {

            spreadsheetId: '1nY2bWQfArOSVuJycBQdEL2VP1UgGFiLzglxPmIIHXaw',

            apiKey: 'AIzaSyABznAS0fH0tYNh6wlS_iEL08b6znNJCL8',

            sheetName: 'Ads Library',

            range: 'A:W',

            updateTagsWebhook: 'https://n8n.srv951152.hstgr.cloud/webhook/ads-library-update-tags'

        };

 

        const PREDEFINED_TAGS = ['Eddie', 'HRAO', 'Stirling', 'Corbel', 'IGL', 'Ange', 'Static-Shift'];

 

        let allAds = [];

        let filteredAds = [];

        let allUniqueTags = new Set(PREDEFINED_TAGS);

        let selectedTagFilters = new Set();

        let currentAdForTagEdit = null;

        let activeFilters = {

            search: '',

            industry: '',

            funnelStage: '',

            offerType: '',

            rating5plus: false,

            tags: new Set()

        };

 

        async function fetchAds() {

            try {

                const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.spreadsheetId}/values/${CONFIG.sheetName}!${CONFIG.range}?key=${CONFIG.apiKey}`;

                const response = await fetch(url);

                const data = await response.json();

 

                if (!data.values || data.values.length < 2) {

                    document.getElementById('adsGrid').innerHTML = '<div class="loading">No ads found</div>';

                    return;

                }

 

                const headers = data.values[0];

                const rows = data.values.slice(1);

 

                allAds = rows.map(row => {

                    const ad = {};

                    headers.forEach((header, index) => {

                        ad[header] = row[index] || '';

                    });

                    return ad;

                });

 

                // Extract all unique tags

                allAds.forEach(ad => {

                    if (ad['Interface Tags']) {

                        const tags = ad['Interface Tags'].split(',').map(t => t.trim()).filter(t => t);

                        tags.forEach(tag => allUniqueTags.add(tag));

                    }

                });

 

                populateFilters();

                filteredAds = [...allAds];

                sortAds();

                renderAds();

                updateStats();

            } catch (error) {

                console.error('Error fetching ads:', error);

                document.getElementById('adsGrid').innerHTML = '<div class="loading">‚ùå Error loading ads</div>';

            }

        }

 

        function populateFilters() {

            // Populate Industry Filter

            const industries = [...new Set(allAds.map(ad => ad['Industry']).filter(i => i))].sort();

            const industrySelect = document.getElementById('industryFilter');

            industries.forEach(industry => {

                const option = document.createElement('option');

                option.value = industry;

                option.textContent = industry;

                industrySelect.appendChild(option);

            });

 

            // Populate Funnel Stage Filter

            const funnelStages = [...new Set(allAds.map(ad => ad['Funnel Stage']).filter(i => i))].sort();

            const funnelSelect = document.getElementById('funnelStageFilter');

            funnelStages.forEach(stage => {

                const option = document.createElement('option');

                option.value = stage;

                option.textContent = stage;

                funnelSelect.appendChild(option);

            });

 

            // Populate Offer Type Filter

            const offerTypes = [...new Set(allAds.map(ad => ad['Offer Type']).filter(i => i))].sort();

            const offerSelect = document.getElementById('offerTypeFilter');

            offerTypes.forEach(type => {

                const option = document.createElement('option');

                option.value = type;

                option.textContent = type;

                offerSelect.appendChild(option);

            });

 

            // Populate Tags

            populateSidebarTags();

        }

 

        function populateSidebarTags() {

            const container = document.getElementById('sidebarTags');

            container.innerHTML = '';

 

            const sortedTags = Array.from(allUniqueTags).sort();

            sortedTags.forEach(tag => {

                const pill = document.createElement('div');

                pill.className = 'sidebar-tag-pill';

                if (activeFilters.tags.has(tag)) {

                    pill.classList.add('selected');

                }

                pill.textContent = tag;

                pill.onclick = () => toggleTagFilter(tag);

                container.appendChild(pill);

            });

        }

 

        function toggleTagFilter(tag) {

            if (activeFilters.tags.has(tag)) {

                activeFilters.tags.delete(tag);

            } else {

                activeFilters.tags.add(tag);

            }

            populateSidebarTags();

            applyFilters();

        }

 

        function applyFilters() {

            filteredAds = allAds.filter(ad => {

                // Search filter

                const matchesSearch = !activeFilters.search ||

                    ad['Brand/Advertiser'].toLowerCase().includes(activeFilters.search) ||

                    ad['Ad Headline'].toLowerCase().includes(activeFilters.search) ||

                    ad['Ad Copy'].toLowerCase().includes(activeFilters.search);

 

                // Industry filter

                const matchesIndustry = !activeFilters.industry || ad['Industry'] === activeFilters.industry;

 

                // Funnel Stage filter

                const matchesFunnelStage = !activeFilters.funnelStage || ad['Funnel Stage'] === activeFilters.funnelStage;

 

                // Offer Type filter

                const matchesOfferType = !activeFilters.offerType || ad['Offer Type'] === activeFilters.offerType;

 

                // Rating filter

                const matchesRating = !activeFilters.rating5plus || parseInt(ad['Rating']) === 5;

 

                // Tag filter (OR logic)

                let matchesTags = true;

                if (activeFilters.tags.size > 0) {

                    const adTags = (ad['Interface Tags'] || '').split(',').map(t => t.trim()).filter(t => t);

                    matchesTags = adTags.some(tag => activeFilters.tags.has(tag));

                }

 

                return matchesSearch && matchesIndustry && matchesFunnelStage && matchesOfferType && matchesRating && matchesTags;

            });

 

            sortAds();

            renderAds();

            updateStats();

            renderActiveFilters();

        }

 

        function sortAds() {

            const sortBy = document.getElementById('sortBy').value;

 

            switch(sortBy) {

                case 'newest':

                    filteredAds.sort((a, b) => new Date(b['Date Added']) - new Date(a['Date Added']));

                    break;

                case 'oldest':

                    filteredAds.sort((a, b) => new Date(a['Date Added']) - new Date(b['Date Added']));

                    break;

                case 'rating-high':

                    filteredAds.sort((a, b) => (parseInt(b['Rating']) || 0) - (parseInt(a['Rating']) || 0));

                    break;

                case 'rating-low':

                    filteredAds.sort((a, b) => (parseInt(a['Rating']) || 0) - (parseInt(b['Rating']) || 0));

                    break;

            }

        }

 

        function renderActiveFilters() {

            const container = document.getElementById('activeFilters');

            container.innerHTML = '';

 

            // Search filter

            if (activeFilters.search) {

                container.appendChild(createFilterPill('Search', activeFilters.search, () => {

                    document.getElementById('globalSearch').value = '';

                    activeFilters.search = '';

                    applyFilters();

                }));

            }

 

            // Industry filter

            if (activeFilters.industry) {

                container.appendChild(createFilterPill('Industry', activeFilters.industry, () => {

                    document.getElementById('industryFilter').value = '';

                    activeFilters.industry = '';

                    applyFilters();

                }));

            }

 

            // Funnel Stage filter

            if (activeFilters.funnelStage) {

                container.appendChild(createFilterPill('Funnel Stage', activeFilters.funnelStage, () => {

                    document.getElementById('funnelStageFilter').value = '';

                    activeFilters.funnelStage = '';

                    applyFilters();

                }));

            }

 

            // Offer Type filter

            if (activeFilters.offerType) {

                container.appendChild(createFilterPill('Offer Type', activeFilters.offerType, () => {

                    document.getElementById('offerTypeFilter').value = '';

                    activeFilters.offerType = '';

                    applyFilters();

                }));

            }

 

            // Rating filter

            if (activeFilters.rating5plus) {

                container.appendChild(createFilterPill('Rating', '5 Stars', () => {

                    document.getElementById('rating5plus').checked = false;

                    activeFilters.rating5plus = false;

                    applyFilters();

                }));

            }

 

            // Tag filters

            activeFilters.tags.forEach(tag => {

                container.appendChild(createFilterPill('Tag', tag, () => {

                    toggleTagFilter(tag);

                }));

            });

        }

 

        function createFilterPill(label, value, onRemove) {

            const pill = document.createElement('div');

            pill.className = 'active-filter-pill';

            pill.innerHTML = `

                <span>${label}: ${value}</span>

                <button class="remove-filter">√ó</button>

            `;

            pill.querySelector('.remove-filter').onclick = onRemove;

            return pill;

        }

 

        function clearAllFilters() {

            document.getElementById('globalSearch').value = '';

            document.getElementById('industryFilter').value = '';

            document.getElementById('funnelStageFilter').value = '';

            document.getElementById('offerTypeFilter').value = '';

            document.getElementById('rating5plus').checked = false;

 

            activeFilters = {

                search: '',

                industry: '',

                funnelStage: '',

                offerType: '',

                rating5plus: false,

                tags: new Set()

            };

 

            populateSidebarTags();

            applyFilters();

        }

 

        function renderAds() {

            const grid = document.getElementById('adsGrid');

 

            if (filteredAds.length === 0) {

                grid.innerHTML = '<div class="loading">No ads match your filters</div>';

                return;

            }

 

            grid.innerHTML = filteredAds.map(ad => {

                const imageUrl = ad['Image Preview'] || ad['Creative URL'] || '';

                const brandLink = ad['Brands Ad Library'] || '#';

                const landingPageUrl = ad['Landing Page URL'] || '#';

                const startedRunningOn = ad['Started Running On'] || '';

                const tags = (ad['Interface Tags'] || '').split(',').map(t => t.trim()).filter(t => t);

                const rating = parseInt(ad['Rating']) || 0;

 

                return `

                    <div class="ad-card">

                        <img src="${imageUrl}" alt="${ad['Ad Headline']}" class="ad-image" loading="lazy">

                        <div class="ad-content">

                            <div class="ad-brand">

                                ${brandLink && brandLink !== '#' ?

                                    `<a href="${brandLink}" target="_blank" rel="noopener noreferrer">${ad['Brand/Advertiser']}</a>` :

                                    ad['Brand/Advertiser']

                                }

                            </div>

                            <div class="ad-meta">

                                <span>${ad['Date Added']}${startedRunningOn ? ` ‚Ä¢ Started: ${startedRunningOn}` : ''}</span>

                                ${rating > 0 ? `

                                    <div class="ad-rating">

                                        ${Array.from({length: 5}, (_, i) =>

                                            `<span class="star ${i < rating ? '' : 'empty'}">‚òÖ</span>`

                                        ).join('')}

                                    </div>

                                ` : ''}

                            </div>

                            <span class="ad-industry">${ad['Industry']}</span>

                            <div class="ad-headline">${ad['Ad Headline']}</div>

                            <div class="ad-copy">${ad['Ad Copy'].substring(0, 200)}${ad['Ad Copy'].length > 200 ? '...' : ''}</div>

                            ${landingPageUrl && landingPageUrl !== '#' ?

                                `<a href="${landingPageUrl}" target="_blank" rel="noopener noreferrer" class="ad-cta">${ad['CTA Button Text'] || 'Learn More'}</a>` :

                                `<div class="ad-cta" style="cursor: default;">${ad['CTA Button Text'] || 'Learn More'}</div>`

                            }

                            <div class="ad-tags-section">

                                <div class="ad-tags-list">

                                    ${tags.length > 0 ?

                                        tags.map(tag => `<span class="tag-chip">${tag}</span>`).join('') :

                                        '<span style="color: #94a3b8; font-size: 12px;">No tags</span>'

                                    }

                                </div>

                                <button class="add-tag-btn" onclick='openTagModal(${JSON.stringify(ad)})'>

                                    Add Tag

                                </button>

                            </div>

                        </div>

                    </div>

                `;

            }).join('');

        }

 

        function updateStats() {

            document.getElementById('totalAds').textContent = allAds.length;

            document.getElementById('showingAds').textContent = filteredAds.length;

        }

 

        function openTagModal(ad) {

            currentAdForTagEdit = ad;

            const modal = document.getElementById('tagModal');

            modal.classList.add('active');

            renderCurrentTags();

            document.getElementById('tagInput').value = '';

        }

 

        function closeTagModal() {

            const modal = document.getElementById('tagModal');

            modal.classList.remove('active');

            currentAdForTagEdit = null;

            document.getElementById('tagSuggestions').classList.remove('active');

        }

 

        function renderCurrentTags() {

            const container = document.getElementById('currentTags');

            const tags = (currentAdForTagEdit['Interface Tags'] || '').split(',').map(t => t.trim()).filter(t => t);

 

            if (tags.length === 0) {

                container.innerHTML = '<div style="color: #94a3b8; font-size: 14px;">No tags added yet</div>';

                return;

            }

 

            container.innerHTML = tags.map(tag => `

                <div class="current-tag-chip">

                    ${tag}

                    <button class="remove-tag" onclick="removeTag('${tag}')">√ó</button>

                </div>

            `).join('');

        }

 

        function removeTag(tagToRemove) {

            const currentTags = (currentAdForTagEdit['Interface Tags'] || '').split(',').map(t => t.trim()).filter(t => t);

            const updatedTags = currentTags.filter(tag => tag !== tagToRemove);

            currentAdForTagEdit['Interface Tags'] = updatedTags.join(', ');

            renderCurrentTags();

        }

 

        function handleTagInputChange(event) {

            const input = event.target.value.toLowerCase();

            const suggestionsDiv = document.getElementById('tagSuggestions');

 

            if (!input) {

                suggestionsDiv.classList.remove('active');

                return;

            }

 

            const matchingTags = Array.from(allUniqueTags).filter(tag =>

                tag.toLowerCase().includes(input)

            );

 

            if (matchingTags.length === 0) {

                suggestionsDiv.classList.remove('active');

                return;

            }

 

            suggestionsDiv.innerHTML = matchingTags.map(tag => `

                <div class="tag-suggestion-item" onclick="addTagFromSuggestion('${tag}')">${tag}</div>

            `).join('');

 

            suggestionsDiv.classList.add('active');

        }

 

        function addTagFromSuggestion(tag) {

            addTag(tag);

            document.getElementById('tagInput').value = '';

            document.getElementById('tagSuggestions').classList.remove('active');

        }

 

        function addTag(tagToAdd) {

            const currentTags = (currentAdForTagEdit['Interface Tags'] || '').split(',').map(t => t.trim()).filter(t => t);

 

            if (currentTags.includes(tagToAdd)) {

                return;

            }

 

            currentTags.push(tagToAdd);

            currentAdForTagEdit['Interface Tags'] = currentTags.join(', ');

            allUniqueTags.add(tagToAdd);

            renderCurrentTags();

        }

 

        async function saveTagsToSheet() {

            const btn = document.querySelector('.save-tags-btn');

            btn.disabled = true;

            btn.textContent = 'Saving...';

 

            try {

                const response = await fetch(CONFIG.updateTagsWebhook, {

                    method: 'POST',

                    headers: {

                        'Content-Type': 'application/json'

                    },

                    body: JSON.stringify({

                        adLink: currentAdForTagEdit['Ad Link'],

                        tags: currentAdForTagEdit['Interface Tags']

                    })

                });

 

                if (!response.ok) {

                    throw new Error('Failed to save tags');

                }

 

                const adIndex = allAds.findIndex(ad => ad['Ad Link'] === currentAdForTagEdit['Ad Link']);

                if (adIndex !== -1) {

                    allAds[adIndex]['Interface Tags'] = currentAdForTagEdit['Interface Tags'];

                }

 

                populateSidebarTags();

                applyFilters();

 

                alert('‚úÖ Tags saved successfully!');

                closeTagModal();

            } catch (error) {

                console.error('Error saving tags:', error);

                alert('‚ùå Failed to save tags: ' + error.message);

            } finally {

                btn.disabled = false;

                btn.textContent = 'Save Tags';

            }

        }

 

        function toggleSidebar() {

            document.getElementById('filterSidebar').classList.toggle('open');

        }

 

        // Event Listeners

        document.getElementById('globalSearch').addEventListener('input', (e) => {

            activeFilters.search = e.target.value.toLowerCase();

            applyFilters();

        });

 

        document.getElementById('industryFilter').addEventListener('change', (e) => {

            activeFilters.industry = e.target.value;

            applyFilters();

        });

 

        document.getElementById('funnelStageFilter').addEventListener('change', (e) => {

            activeFilters.funnelStage = e.target.value;

            applyFilters();

        });

 

        document.getElementById('offerTypeFilter').addEventListener('change', (e) => {

            activeFilters.offerType = e.target.value;

            applyFilters();

        });

 

        document.getElementById('rating5plus').addEventListener('change', (e) => {

            activeFilters.rating5plus = e.target.checked;

            document.getElementById('ratingFilter').classList.toggle('active', e.target.checked);

            applyFilters();

        });

 

        document.getElementById('sortBy').addEventListener('change', () => {

            sortAds();

            renderAds();

        });

 

        document.getElementById('tagInput').addEventListener('input', handleTagInputChange);

        document.getElementById('tagInput').addEventListener('keypress', (e) => {

            if (e.key === 'Enter') {

                const value = e.target.value.trim();

                if (value) {

                    addTag(value);

                    e.target.value = '';

                    document.getElementById('tagSuggestions').classList.remove('active');

                }

            }

        });

 

        document.getElementById('tagSearchInput').addEventListener('input', (e) => {

            const searchTerm = e.target.value.toLowerCase();

            const pills = document.querySelectorAll('.sidebar-tag-pill');

            pills.forEach(pill => {

                const tagName = pill.textContent.toLowerCase();

                pill.style.display = tagName.includes(searchTerm) ? 'inline-flex' : 'none';

            });

        });

 

        document.getElementById('tagModal').addEventListener('click', (e) => {

            if (e.target.id === 'tagModal') {

                closeTagModal();

            }

        });

 

        // Initialize

        fetchAds();

    </script>

</body>

</html>

